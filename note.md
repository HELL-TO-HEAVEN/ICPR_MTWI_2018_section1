# 笔记

## 原始数据

* 图像
* 图像对应的文本以及文本对应的位置坐标

## 输入数据格式说明

* 一个五维的列表，列表各个维度意义为[批次，[图像宽，图像高，通道数]，文本独热矩阵，预测序列最大长度，真值序列长度]
* 图像高已经限定为32
* 文本稠密向量为一个长度为n_len的向量，向量的每一维为字符在字典中的index值，不足n_len补零
* 预测序列长度可以直接设成图片宽
* 真值序列长度是文本独热矩阵包含的文本独热向量数
* 训练用图片长宽固定

## 输出数据格式说明

* 一个独热矩阵，需要经过ctc解码之后才能得出原来的文本

## 模型参数来源

arXiv:1507.05717v1  [cs.CV]  21 Jul 2015

## 数据预处理

* 对于竖向文本，先等比放缩使高变为32，然后将图像从上往下切成32x32的若干块再横向拼接
* 彩色图像处理有两种方法：抽取出单独一个颜色通道/将图像灰度化
* 最后将图像和文本打包成tfrecord
* 字典内含字5529个，但是要分5530个类（空白类）

## 变长序列变长在哪？

将CNN输出按图片宽度展平，得到一个不定长的序列

## 关于the_labels的输入问题

因为这里loss函数使用的是tf.ctc_batch_cost()，所以输入不是独热向量而是稠密向量，向量的每一维是字典索引

## 常见错误

* sequence length：给RNN的张量深度低了或者label的维度太高
* shape问题，对图片进行放缩
* loss出现inf/no valid path found：time step太短或者label截的太多或者句子太长，拓展timestep或者裁剪图片